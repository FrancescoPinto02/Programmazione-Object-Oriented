package gui;

import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.Calendar;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;

import core.*;

@SuppressWarnings("serial")
public class MainGUI extends JFrame {

	private ArrayList<Malware> malware;
	private JPanel panel;
	
	public MainGUI(String titolo, ArrayList<Malware> malware) {
		this.malware = malware;
		this.setTitle(titolo);
		this.setSize(800, 100);
		this.setLocation(500, 500);
		this.setDefaultCloseOperation(EXIT_ON_CLOSE);
		this.panel = buildPanel();
		add(this.panel);
	}
	
	
	private JPanel buildPanel() {
		JPanel mainPanel = new JPanel();
		
		JButton b1 = new JButton("Stampa Ordinata");
		b1.addActionListener((ActionEvent e)->{
			System.out.println("\n\nMalware Ordinati per data di rilascio");
			this.malware.stream().sorted((x,y)->{
				return x.getRilascio().compareTo(y.getRilascio());
			}).forEach(System.out::println);
		});
		
		JButton b2 = new JButton("Stampa Pericolo MEDIO");
		b2.addActionListener((ActionEvent e)->{
			System.out.println("\n\nMalware con livello di Pericolo MEDIO");
			this.malware.stream().filter(x->{
				return x.getPericolo()==Malware.MEDIO;
			}).forEach(System.out::println);
		});
		
		JButton b3 = new JButton("Stampa numero Malware 2022");
		b3.addActionListener((ActionEvent e)->{
			int count = (int)this.malware.stream().filter(x -> {
				return x.getRilascio().get(Calendar.YEAR) == 2022;
			}).count();
			
			System.out.println("\n\nMalware Rilasciati nel 2022: " + count);
		});
		
		JButton b4 = new JButton("Salva su File");
		b4.addActionListener((ActionEvent e)->{
			PrintWriter out = null;
			try {
				out = new PrintWriter(new BufferedWriter(new FileWriter("output.txt")));
				for(Malware x : this.malware) {
					out.println(x);
				}
				out.close();
			}
			catch(Exception e1) {
				e1.printStackTrace();
				out.close();
			}
		});
		
		mainPanel.setLayout(new GridLayout(2,2));
		mainPanel.add(b1);
		mainPanel.add(b2);
		mainPanel.add(b3);
		mainPanel.add(b4);
		
		
		return mainPanel;
	}
}
